<!DOCTYPE html>
<html lang="fi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Taselaskuri</title>
    <style>
        table, th, td { border: 1px solid black; border-collapse: collapse; padding: 5px; }
    </style>
    <script>
        function addRow() {
            const table = document.getElementById("balanceSheetTable");
            const row = table.insertRow();
            
            row.innerHTML = `
                <td><input type="text" name="name[]" required></td>
                <td>
                    <select name="class[]" required>
                        <option value="Vara">Vara</option>
                        <option value="Velka">Velka</option>
                    </select>
                </td>
                <td><input type="number" step="0.01" name="book_value[]" required></td>
                <td><input type="number" step="0.01" name="market_value[]" required></td>
                <td><input type="text" name="comment[]"></td>
                <td><button type="button" onclick="this.closest('tr').remove()">Poista</button></td>
            `;;
        }
    </script>
</head>
<body>
    <h1>Taselaskuri</h1>
    <p>Tase on taloudellinen tilannekuva, joka näyttää varasi ja velkasi yhdellä silmäyksellä. 
    Se kertoo vakavaraisuutesi sekä sen, kuinka varallisuutesi on rahoitettu. 
    Jos varasi ylittävät velkasi, sinulla on omaa pääomaa eli itse rahoitettuja varoja.</p>
    <form method="POST">
        <table id="balanceSheetTable">
            <tr>
                <th>Nimi</th>
                <th>Tyyppi</th>
                <th>Kirjanpitoarvo</th>
                <th>Markkina-arvo</th>
                <th>Kommentti</th>
                <th>Poista</th>
            </tr>
            {% if rows %}
                {% for row in rows %}
                <tr>
                    <td><input type="text" name="name[]" value="{{ row.name }}" required></td>
                    <td>
                        <select name="class[]" required>
                            <option value="Vara" {% if row.class == 'Vara' %}selected{% endif %}>Vara</option>
                            <option value="Velka" {% if row.class == 'Velka' %}selected{% endif %}>Velka</option>
                        </select>
                    </td>
                    <td><input type="number" step="0.01" name="book_value[]" value="{{ row.book_value }}" required></td>
                    <td><input type="number" step="0.01" name="market_value[]" value="{{ row.market_value }}" required></td>
                    <td><input type="text" name="comment[]" value="{{ row.comment }}"></td>
                    <td><button type="button" onclick="this.parentElement.parentElement.remove()">Poista</button></td>
                </tr>[]" value="{{ row.name }}" required></td>
                    <td>
                        <select name="class[]" required>
                            <option value="Vara" {% if row.class == 'Vara' %}selected{% endif %}>Vara</option>
                            <option value="Velka" {% if row.class == 'Velka' %}selected{% endif %}>Velka</option>
                        </select>
                    </td>
                    <td><input type="number" step="0.01" name="book_value[]" value="{{ row.book_value }}" required></td>
                    <td><input type="number" step="0.01" name="market_value[]" value="{{ row.market_value }}" required></td>
                    <td><input type="text" name="comment[]" value="{{ row.comment }}"></td>
                </tr>
                {% endfor %}
            {% else %}
                <tr>
                    <td><input type="text" name="name[]" required></td>
                    <td>
                        <select name="class[]" required>
                            <option value="Vara">Vara</option>
                            <option value="Velka">Velka</option>
                        </select>
                    </td>
                    <td><input type="number" step="0.01" name="book_value[]" required></td>
                    <td><input type="number" step="0.01" name="market_value[]" required></td>
                    <td><input type="text" name="comment[]"></td>
                </tr>
            {% endif %}
          

       </table>
        <br>
        <button type="button" onclick="addRow()">Lisää rivi</button>
        <input type="submit" value="Laske">
        <br><br> <!-- Välilyönti nappien jälkeen -->

        <div style="background-color:#f0f0f0; padding:10px; font-size:0.9em;">
            <strong>Selitykset:</strong> 
            <br><strong>Nimi</strong> = kohteen tai erän nimi (esim. pankkitili, kone, laina) 
            <br><strong>Tyyppi</strong> = Vara (omistettava resurssi) tai Velka (velvoite)
            <br><strong>Kirjanpitoarvo</strong> = kohteen arvo kirjanpidossa eli hankintahinta tai jäännösarvo 
            <br><strong>Markkina-arvo</strong> = kohteen nykyinen markkina-arvo
            <br><strong>Jäännösarvo</strong> = omaisuuserän nykyinen kirjanpidollinen arvo poistojen jälkeen
            <br><strong>Poisto</strong> = erän arvon aleneminen ajan myötä
        </div>

    {% if result %}
        <h2>Yhteenveto:</h2>
        <p><strong>Varat yhteensä (kirjanpitoarvo):</strong> {{ result.total_assets_book }}</p>
        <p><strong>Varat yhteensä (markkina-arvo):</strong> {{ result.total_assets_market }}</p>
        <p><strong>Velat yhteensä (kirjanpitoarvo):</strong> {{ result.total_liabilities_book }}</p>
        <p><strong>Velat yhteensä (markkina-arvo):</strong> {{ result.total_liabilities_market }}</p>
        <p><strong>Oma pääoma (kirjanpitoarvo):</strong> {{ result.equity_book }}</p>
        <p><strong>Oma pääoma (markkina-arvo):</strong> {{ result.equity_market }}</p>
    {% endif %}

    {% if error %}
        <p style="color:red;">{{ error }}</p>
    {% endif %}
</body>
</html>
